<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Test</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #121212;
      color: #ffffff;
    }
    .card {
      background-color: #1e1e1e;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    button {
      background-color: #3b82f6;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background-color: #2563eb;
    }
    button.disconnect {
      background-color: #ef4444;
    }
    button.disconnect:hover {
      background-color: #dc2626;
    }
    #status {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
    }
    .connected {
      background-color: rgba(16, 185, 129, 0.2);
    }
    .disconnected {
      background-color: rgba(239, 68, 68, 0.2);
    }
    #log {
      height: 300px;
      overflow-y: auto;
      background-color: #2d3748;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
    }
    .log-entry {
      margin-bottom: 5px;
      border-bottom: 1px solid #4a5568;
      padding-bottom: 5px;
    }
    .timestamp {
      color: #a0aec0;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h1>WebSocket Test</h1>
  
  <div class="card">
    <h2>Connection</h2>
    <div>
      <input type="text" id="wsUrl" value="ws://localhost:8765" style="width: 300px; padding: 8px; margin-right: 10px; background-color: #2d3748; color: white; border: 1px solid #4a5568; border-radius: 4px;">
      <button id="connect">Connect</button>
      <button id="disconnect" class="disconnect">Disconnect</button>
    </div>
    <div id="status" class="disconnected">Disconnected</div>
  </div>
  
  <div class="card">
    <h2>Send Message</h2>
    <div>
      <input type="text" id="messageType" placeholder="Message type" style="width: 150px; padding: 8px; margin-right: 10px; background-color: #2d3748; color: white; border: 1px solid #4a5568; border-radius: 4px;">
      <input type="text" id="messageData" placeholder="Message data (JSON)" style="width: 300px; padding: 8px; margin-right: 10px; background-color: #2d3748; color: white; border: 1px solid #4a5568; border-radius: 4px;">
      <button id="send">Send</button>
    </div>
  </div>
  
  <div class="card">
    <h2>Log</h2>
    <div id="log"></div>
  </div>

  <script>
    // DOM elements
    const wsUrlInput = document.getElementById('wsUrl');
    const connectButton = document.getElementById('connect');
    const disconnectButton = document.getElementById('disconnect');
    const statusDiv = document.getElementById('status');
    const messageTypeInput = document.getElementById('messageType');
    const messageDataInput = document.getElementById('messageData');
    const sendButton = document.getElementById('send');
    const logDiv = document.getElementById('log');
    
    // WebSocket instance
    let socket = null;
    
    // Log function
    function log(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      
      const timestamp = document.createElement('span');
      timestamp.className = 'timestamp';
      timestamp.textContent = new Date().toLocaleTimeString();
      
      const content = document.createElement('span');
      content.textContent = message;
      
      entry.appendChild(timestamp);
      entry.appendChild(content);
      
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }
    
    // Connect function
    function connect() {
      if (socket && (socket.readyState === WebSocket.OPEN || socket.readyState === WebSocket.CONNECTING)) {
        log('WebSocket is already connected or connecting');
        return;
      }
      
      const url = wsUrlInput.value.trim();
      log(`Connecting to ${url}...`);
      
      try {
        socket = new WebSocket(url);
        
        socket.onopen = (event) => {
          log('Connected!');
          statusDiv.textContent = 'Connected';
          statusDiv.className = 'connected';
        };
        
        socket.onmessage = (event) => {
          log(`Received: ${event.data}`);
          try {
            const data = JSON.parse(event.data);
            log(`Parsed: ${JSON.stringify(data, null, 2)}`);
          } catch (error) {
            log(`Error parsing message: ${error.message}`);
          }
        };
        
        socket.onclose = (event) => {
          log(`Disconnected: ${event.code} ${event.reason}`);
          statusDiv.textContent = 'Disconnected';
          statusDiv.className = 'disconnected';
          socket = null;
        };
        
        socket.onerror = (event) => {
          log('WebSocket error');
          statusDiv.textContent = 'Error';
          statusDiv.className = 'disconnected';
        };
      } catch (error) {
        log(`Error creating WebSocket: ${error.message}`);
        statusDiv.textContent = 'Error';
        statusDiv.className = 'disconnected';
      }
    }
    
    // Disconnect function
    function disconnect() {
      if (!socket) {
        log('WebSocket is not connected');
        return;
      }
      
      log('Disconnecting...');
      socket.close();
    }
    
    // Send function
    function sendMessage() {
      if (!socket || socket.readyState !== WebSocket.OPEN) {
        log('Cannot send message, WebSocket is not connected');
        return;
      }
      
      const type = messageTypeInput.value.trim();
      const dataStr = messageDataInput.value.trim();
      
      if (!type) {
        log('Message type is required');
        return;
      }
      
      let data = {};
      if (dataStr) {
        try {
          data = JSON.parse(dataStr);
        } catch (error) {
          log(`Error parsing message data: ${error.message}`);
          return;
        }
      }
      
      const message = {
        type,
        data,
        timestamp: Date.now()
      };
      
      log(`Sending: ${JSON.stringify(message)}`);
      socket.send(JSON.stringify(message));
    }
    
    // Event listeners
    connectButton.addEventListener('click', connect);
    disconnectButton.addEventListener('click', disconnect);
    sendButton.addEventListener('click', sendMessage);
  </script>
</body>
</html>
